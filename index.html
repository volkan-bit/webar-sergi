<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebAR Sergi</title>

  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: targets.mind;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: true">

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <!-- QR MARKER -->
  <a-entity id="marker" mindar-image-target="targetIndex: 0">
    <a-plane
      id="artwork"
      src="resim1.jpg"
      width="1"
      height="1.4"
      scale="3 3 3">
    </a-plane>
  </a-entity>

</a-scene>

<script>
const marker = document.querySelector("#marker");
const artwork = document.querySelector("#artwork");
const scene = document.querySelector("a-scene");

let locked = false;

marker.addEventListener("targetFound", () => {
  if (locked) return;
  locked = true;

  const THREE = AFRAME.THREE;

  // Marker dünya pozisyonu
  const markerWorldPos = new THREE.Vector3();
  marker.object3D.getWorldPosition(markerWorldPos);

  // Marker dünya rotasyonu
  const markerWorldQuat = new THREE.Quaternion();
  marker.object3D.getWorldQuaternion(markerWorldQuat);

  // QR'ın 15cm üstü (duvar yukarısı)
  const offset = new THREE.Vector3(0, 0.15, 0);
  offset.applyQuaternion(markerWorldQuat);

  // Artwork'ü sahneye taşı
  scene.object3D.add(artwork.object3D);
  artwork.object3D.position.copy(markerWorldPos).add(offset);
  artwork.object3D.quaternion.copy(markerWorldQuat);

  // Marker takibini kapat
  marker.setAttribute("mindar-image-target", "enabled", false);
});
</script>

</body>
</html>
